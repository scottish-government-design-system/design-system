@use "../../base/helpers/colours/colours" as colours2;
@use "../../base/helpers/functions/functions";
@use "../../base/helpers/media-query/media-query";
@use "../../base/helpers/spacing/spacing";
@use "../../base/helpers/visibility/visibility";
@use "../../base/settings/colours/colours";
@use "../../base/settings/type/type";

/*------------------------------------*\
    TABLES
\*------------------------------------*/

$table-border-colour: colours.$ds_colour__border !default;
$table-border-colour--light: colours.$ds_colour__border--faint !default;
$table-header-background-colour: colours.$ds_colour__background--tertiary !default;
$table-row-zebra-colour: colours.$ds_colour__background--primary--dim !default;




.ds_table {
    // table-layout: fixed;
    width: 100%;
    @include spacing.responsive-margin(2, bottom);


    caption {
        @include spacing.responsive-margin(2, bottom);
        font-size: type.$root-font-size; // 1rem
        font-weight: type.$bold;
        line-height: functions.line-height-on-grid(type.$root-font-size);
        text-align: left;
    }

    tbody,
    thead,
    tfoot {
        border: 0.0625rem solid $table-border-colour;
    }

    tr {
        border-bottom: 0.0625rem solid $table-border-colour--light;
    }

    tr > * {
        /// [1] compensate for table row 1px border
        padding: 0.5rem 1rem 0.4375rem 0.5rem; /// [1]
    }

    tr:last-child {
        //border-bottom-color: $table-border-colour;
        border-bottom: 0;
    }

    th {
        background-color: $table-header-background-colour;
        font-weight: type.$bold;
        position: relative;
        text-align: left;

        @include colours2.checkAndFixDescendantLinkColour(colours.$ds_colour__link, $table-header-background-colour, 'table header');
    }

    th,
    td {
        vertical-align: top;
    }

    th[colspan] {
        border: 0.0625rem solid $table-border-colour;
    }

    th:not(:first-child)::before {
        border-left: 0.0625rem solid $table-border-colour;
        bottom: 0.5rem;
        content: '';
        left: -0.0625rem;
        position: absolute;
        top: 0.5rem;
    }

    thead > tr:last-child {
        border-bottom: 0;
    }

    tbody > tr > td {
        background-color: colours.$ds_colour__background--primary;
    }

    tbody > tr:nth-child(even) > td {
        background-color: $table-row-zebra-colour;

        @include colours2.checkAndFixDescendantLinkColour(colours.$ds_colour__link, $table-row-zebra-colour, 'table zebra');
    }
}

@include media-query.media-query(medium-down) {
    .ds_table.js-is-scrolling {
        &[data-smallscreen="scrolling"] {
            display: block;
            max-width: 100%;
            overflow-x: auto;
        }

        &[data-smallscreen="scrolling"] tr > :first-child {
            left: 0;
            position: sticky;
            z-index: 1;
        }

        &[data-smallscreen="scrolling"] caption {
            display: block;
            left: 0;
            position: sticky;
        }

        &[data-smallscreen="scrolling"] tr > :first-child::after {
            background: linear-gradient(90deg, rgba(0,0,0,0.07), rgba(0,0,0,0));
            content: '';
            height: 100%;
            position: absolute;
            right: -0.625rem;
            top: 0;
            width: 0.625rem;
        }

        &[data-smallscreen="scrolling"] tr > :first-child::before {
            background: $table-border-colour;
            content: '';
            height: 100%;
            left: -0.0625rem;
            position: absolute;
            top: 0;
            width: 0.0625rem;
        }

        &[data-smallscreen="scrolling"] tr > th:first-child {
            background: $table-header-background-colour;
        }

        &[data-smallscreen="scrolling"] tr > td:first-child {
            border-right: 0.0625rem solid $table-header-background-colour;
        }
    }

    .js-enabled {
        .ds_table {
            &[data-smallscreen="boxes"] {
                border: 0;
                margin-bottom: 0;
            }

            &[data-smallscreen="boxes"] thead {
                @include visibility.visually-hidden;
            }

            &[data-smallscreen="boxes"] tbody {
                border: none;
            }

            &[data-smallscreen="boxes"] tr {
                border: 0;
                display: block;
                margin-bottom: 1rem;
            }

            &[data-smallscreen="boxes"] tr > * {
                border: 0.0625rem solid $table-border-colour;
                display: block;
                overflow: auto;
                padding-left: calc(50% - 0.5rem);
                position: relative;
            }

            &[data-smallscreen="boxes"] tr > td:not(:last-child) {
                border-bottom-color: $table-border-colour--light;
            }

            &[data-smallscreen="boxes"] tr > th:last-child {
                border-width: 0;
                margin-top: 2rem;
            }

            &[data-smallscreen="boxes"] tr > td:not(:first-child) {
                border-top-width: 0;
            }

            &[data-smallscreen="boxes"] tr > td::before {
                content: attr(data-heading);
                display: block;
                position: absolute;
                font-weight: type.$bold;
                left: 0;
                margin-left: 1rem;
                margin-right: 1rem;
                text-align: left;
                width: calc(50% - 1rem);
            }

            &[data-smallscreen="boxes"] tr > td:first-child {
                box-shadow: inset 0 0.25rem 0 $table-border-colour--light;
                padding-top: 0.6875rem;
            }

            &[data-smallscreen="boxes"] tr > td:nth-child(odd) {
                background-color: colours.$ds_colour__background--primary;
            }

            &[data-smallscreen="boxes"] tr > td:nth-child(even) {
                background-color: $table-row-zebra-colour;
            }

        }
    }
}
