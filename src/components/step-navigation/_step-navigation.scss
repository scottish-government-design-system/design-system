@use "../../base/helpers/functions/functions";
@use "../../base/helpers/media-query/media-query";
@use "../../base/helpers/spacing/spacing";
@use "../../base/settings/colours/colours";
@use "../../base/settings/type/type";

/*------------------------------------*\
    #STEP NAVIGATION
    Step navigation is an enhancement to the DS accordion
\*------------------------------------*/

@use "sass:math";

$step-count-margin: 2.5rem;
$step-count-margin--medium: 3rem;
$step-count-size: 2rem;
$step-count-size--medium: 2.5rem;
$step-content-line-height: 1.5rem;
$step-content-line-height--medium: 2rem;

.ds_step-navigation {
    counter-reset: section;

    &__list {
        list-style-type: none;
        margin: 0;

        li {
            margin-bottom: 0;
        }
    }

    &__title {
        font-size: type.$h3-size;
        line-height: 1.5rem;
    }

    &__title-link {
        display: block;
        @include spacing.responsive-margin(3, bottom);
        @include spacing.responsive-margin(1, top);
        text-decoration: underline;
    }

    &__current-link::before {
        content: '';
        position: absolute;
        left: #{math.div($step-count-size, 2) - $step-count-margin};
        right: 100%;
        height: 0.0625rem;
        background: colours.$ds_colour__border--strong;
        margin-top: math.div($step-content-line-height, 2);
    }

    &__count {
        background-color: colours.$ds_colour__background--primary;
        border: 0.0625rem solid currentColor;
        border-radius: 1.25rem;
        color: colours.$ds_colour__border--strong;
        content: counter(section);
        counter-increment: section;
        display: block;
        font-size: type.$root-font-size;
        font-weight: type.$bold;
        height: $step-count-size;
        left: #{$step-count-margin * -1};
        line-height: #{$step-count-size - 0.125rem};
        position: absolute;
        text-align: center;
        top: 0.75rem;
        width: $step-count-size;
    }

    .ds_current &__count {
        background-color: colours.$ds_colour__link--current__background;
        border: 0.125rem solid colours.$ds_colour__border--highlight;
        line-height: #{$step-count-size - 0.25rem};
    }

    .ds_accordion {
        margin-left: $step-count-margin;
    }

    .ds_accordion-item {
        position: relative;

        &::before {
            background: colours.$ds_colour__border--strong;
            bottom: functions.px-to-rem(-17px);
            content: '';
            display: block;
            left: #{math.div($step-count-size, 2) - $step-count-margin};
            position: absolute;
            top: functions.px-to-rem(39px);
            width: 0.0625rem;
        }

        &:last-child::before {
            bottom: 0 !important;
        }

        &:last-child::after {
            background: colours.$ds_colour__border--strong;
            bottom: -0.0625rem;
            content: '';
            display: block;
            height: 0.0625rem;
            left: #{math.div($step-count-size, 2) - $step-count-margin - 0.375rem};
            position: absolute;
            width: functions.px-to-rem(13px);
        }
    }

    &__or,
    &__and {
        counter-increment: section -1;
    }

    &__or &__count,
    &__and &__count {
        background-color: transparent;
        border: none;
    }
}

@include media-query.media-query(medium) {
    .ds_step-navigation:not(.ds_step-navigation--small) {
        .ds_step-navigation__count {
            font-size: type.$root-font-size--medium;
            height: $step-count-size--medium;
            left: #{$step-count-margin--medium * -1};
            line-height: #{$step-count-size--medium - 0.125rem};
            width: $step-count-size--medium;
        }

        .ds_current .ds_step-navigation__count {
            line-height: #{$step-count-size--medium - 0.25rem};
        }

        .ds_step-navigation__current-link::before {
            left: #{math.div($step-count-size--medium, 2) - $step-count-margin--medium};
            margin-top: math.div($step-content-line-height--medium, 2);
        }

        .ds_accordion {
            margin-left: $step-count-margin--medium;
        }

        .ds_accordion-item::before {
            bottom: functions.px-to-rem(-17px);
            left: #{math.div($step-count-size--medium, 2) - $step-count-margin--medium};
            top: functions.px-to-rem(49px);
        }

        .ds_accordion-item:last-child::after {
            left: #{math.div($step-count-size--medium, 2) - $step-count-margin--medium - 0.375rem};
        }
    }
}
